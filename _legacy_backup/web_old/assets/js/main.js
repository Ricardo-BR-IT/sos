
const translations = {
    en: {
        navLogo: 'RESGATE <span class="text-red">SOS</span>',
        navFeatures: 'Features',
        navDownloads: 'Downloads',
        navHardware: 'Hardware',
        btnLaunch: 'Launch App',
        heroTitle: 'RESGATE <span class="text-red">SOS</span>',
        heroSub: 'V4 RELEASED: Sensors & Robotics',
        heroLead: '186 Technologies. One Platform. The ultimate survival mesh.',
        btnUseWeb: 'Use System via Web',
        btnDownloadNative: 'or Download Native Apps',
        statTechs: 'Technologies',
        statCoverage: 'Coverage',
        statWaves: 'Development Waves',
        statPlatforms: 'Platforms',
        archTitle: 'System Architecture',
        archHardware: '1. Hardware Layer',
        archHardwareDesc: 'Supports essentially any device: Laptops, Phones, Servers, Raspberry Pis, ESP32 microcontrollers, and custom FPGA radios.',
        archMesh: '2. Mesh Layer',
        archMeshDesc: 'Hybrid promiscuous routing. Optimized flooding with Bloom Filters. Store-and-forward DTN capabilities for varying connectivity.',
        archTransport: '3. Transport Layer',
        archTransportDesc: '<strong>186 Drivers</strong> managed by a unified <code>TransportManager</code>. Auto-switching between WiFi, LoRa, Satellite, and Acoustic modems.',
        archService: '4. Service Layer',
        archServiceDesc: 'Decentralized services: DNS, DHCP, Messaging (AMQP/SMTP), Streaming (RTMP), and Location (GNSS) over the mesh.',
        archApp: '5. Application Layer',
        archAppDesc: 'Premium UI/UX for Chat, Maps, Voice Calls, and File Sharing. Works on Android, Windows, Linux, Web, and Wear OS.',
        archSecurity: '6. Security Layer',
        archSecurityDesc: 'End-to-end encryption using MLS (Messaging Layer Security) + OSCORE/EDHOC for IoT constraint devices.',
        futureTitle: 'Future Initiatives & Innovation',
        futureRoadmap: 'Roadmap V5 "Intelligence" approved by the Specialist Council (13/02/2026).',
        downloadTitle: 'Deploy Your Mesh',
        footerCopy: '&copy; 2026 Resgate SOS Platform. Open Source Humanitarian Technology.',
        footerBuilt: 'Built with Flutter, Dart, C++, and Python.'
    },
    pt: {
        navLogo: 'RESGATE <span class="text-red">SOS</span>',
        navFeatures: 'Recursos',
        navDownloads: 'Downloads',
        navHardware: 'Hardware',
        btnLaunch: 'Abrir App',
        heroTitle: 'RESGATE <span class="text-red">SOS</span>',
        heroSub: 'V4 LANÇADA: Sensores & Robótica',
        heroLead: '186 Tecnologias. Uma Plataforma. A malha de sobrevivência definitiva.',
        btnUseWeb: 'Usar Sistema via Web',
        btnDownloadNative: 'ou Baixar Apps Nativos',
        statTechs: 'Tecnologias',
        statCoverage: 'Cobertura',
        statWaves: 'Ondas de Desenv.',
        statPlatforms: 'Plataformas',
        archTitle: 'Arquitetura do Sistema',
        archHardware: '1. Camada de Hardware',
        archHardwareDesc: 'Suporta essencialmente qualquer dispositivo: Laptops, Celulares, Servidores, Raspberry Pis, microcontroladores ESP32 e rádios FPGA customizados.',
        archMesh: '2. Camada Mesh',
        archMeshDesc: 'Roteamento promíscuo híbrido. Inundação otimizada com Filtros Bloom. Capacidades DTN store-and-forward para conectividade variável.',
        archTransport: '3. Camada de Transporte',
        archTransportDesc: '<strong>186 Drivers</strong> gerenciados por um <code>TransportManager</code> unificado. Troca automática entre WiFi, LoRa, Satélite e modems Acústicos.',
        archService: '4. Camada de Serviço',
        archServiceDesc: 'Serviços descentralizados: DNS, DHCP, Mensageria (AMQP/SMTP), Streaming (RTMP) e Localização (GNSS) sobre a malha.',
        archApp: '5. Camada de Aplicação',
        archAppDesc: 'UI/UX Premium para Chat, Mapas, Chamadas de Voz e Compartilhamento de Arquivos. Funciona em Android, Windows, Linux, Web e Wear OS.',
        archSecurity: '6. Camada de Segurança',
        archSecurityDesc: 'Criptografia de ponta a ponta usando MLS (Messaging Layer Security) + OSCORE/EDHOC para dispositivos IoT restritos.',
        futureTitle: 'Futuras Iniciativas & Inovação',
        futureRoadmap: 'Roadmap V5 "Intelligence" aprovado pelo Conselho de Especialistas (13/02/2026).',
        downloadTitle: 'Implante sua Malha',
        footerCopy: '&copy; 2026 Resgate SOS Platform. Tecnologia Humanitária de Código Aberto.',
        footerBuilt: 'Construído com Flutter, Dart, C++ e Python.'
    },
    es: {
        navLogo: 'RESGATE <span class="text-red">SOS</span>',
        navFeatures: 'Características',
        navDownloads: 'Descargas',
        navHardware: 'Hardware',
        btnLaunch: 'Abrir App',
        heroTitle: 'RESGATE <span class="text-red">SOS</span>',
        heroSub: 'V4 LANZADA: Sensores y Robótica',
        heroLead: '186 Tecnologías. Una Plataforma. La malla de supervivencia definitiva.',
        btnUseWeb: 'Usar Sistema vía Web',
        btnDownloadNative: 'o Descargar Apps Nativas',
        statTechs: 'Tecnologías',
        statCoverage: 'Cobertura',
        statWaves: 'Ondas de Desarr.',
        statPlatforms: 'Plataformas',
        archTitle: 'Arquitectura del Sistema',
        archHardware: '1. Capa de Hardware',
        archHardwareDesc: 'Soporta esencialmente cualquier dispositivo: Laptops, Celulares, Servidores, Raspberry Pis, microcontroladores ESP32 y radios FPGA personalizados.',
        archMesh: '2. Capa Mesh',
        archMeshDesc: 'Enrutamiento promiscuo híbrido. Inundación optimizada con Filtros Bloom. Capacidades DTN store-and-forward para conectividad variable.',
        archTransport: '3. Capa de Transporte',
        archTransportDesc: '<strong>186 Controladores</strong> gestionados por un <code>TransportManager</code> unificado. Cambio automático entre WiFi, LoRa, Satélite y módems Acústicos.',
        archService: '4. Capa de Servicio',
        archServiceDesc: 'Servicios descentralizados: DNS, DHCP, Mensajería (AMQP/SMTP), Streaming (RTMP) y Localización (GNSS) sobre la malla.',
        archApp: '5. Capa de Aplicación',
        archAppDesc: 'UI/UX Premium para Chat, Mapas, Llamadas de Voz y Compartir Archivos. Funciona en Android, Windows, Linux, Web y Wear OS.',
        archSecurity: '6. Capa de Seguridad',
        archSecurityDesc: 'Cifrado de extremo a extremo usando MLS (Messaging Layer Security) + OSCORE/EDHOC para dispositivos IoT restringidos.',
        futureTitle: 'Futuras Iniciativas e Innovación',
        futureRoadmap: 'Roadmap V5 "Intelligence" aprobado por el Consejo de Especialistas (13/02/2026).',
        downloadTitle: 'Despliegua tu Malla',
        footerCopy: '&copy; 2026 Resgate SOS Platform. Tecnología Humanitaria de Código Abierto.',
        footerBuilt: 'Construido con Flutter, Dart, C++ y Python.'
    }
};

let currentLang = 'en';

document.addEventListener('DOMContentLoaded', () => {
    initLanguage();
    fetchTechData();
    setupSmoothScroll();
});

function initLanguage() {
    const savedLang = localStorage.getItem('sos_lang');
    const browserLang = navigator.language.split('-')[0];
    
    if (savedLang && translations[savedLang]) {
        currentLang = savedLang;
    } else if (translations[browserLang]) {
        currentLang = browserLang;
    }
    
    updateUI();
}

function setLanguage(lang) {
    if (translations[lang]) {
        currentLang = lang;
        localStorage.setItem('sos_lang', lang);
        updateUI();
    }
}

function updateUI() {
    const t = translations[currentLang];
    
    // Selectors mapping
    const mappings = {
        '.nav-logo': 'navLogo',
        '.nav-links a[href="#features"]': 'navFeatures',
        '.nav-links a[href="#downloads"]': 'navDownloads',
        '.nav-links a[href="web/iniciativas_hardware.html"]': 'navHardware',
        '.btn-nav': 'btnLaunch',
        'header.hero h1': 'heroTitle',
        'header.hero h2': 'heroSub',
        'header.hero p': 'heroLead',
        '.btn-launch': 'btnUseWeb',
        'header.hero a[href="#downloads"]': 'btnDownloadNative',
        '.stats-grid .stat-card:nth-child(1) .stat-label': 'statTechs',
        '.stats-grid .stat-card:nth-child(2) .stat-label': 'statCoverage',
        '.stats-grid .stat-card:nth-child(3) .stat-label': 'statWaves',
        '.stats-grid .stat-card:nth-child(4) .stat-label': 'statPlatforms',
        '.features h2': 'archTitle',
        '.feature-item:nth-child(1) h3': 'archHardware',
        '.feature-item:nth-child(1) p': 'archHardwareDesc',
        '.feature-item:nth-child(2) h3': 'archMesh',
        '.feature-item:nth-child(2) p': 'archMeshDesc',
        '.feature-item:nth-child(3) h3': 'archTransport',
        '.feature-item:nth-child(3) p': 'archTransportDesc',
        '.feature-item:nth-child(4) h3': 'archService',
        '.feature-item:nth-child(4) p': 'archServiceDesc',
        '.feature-item:nth-child(5) h3': 'archApp',
        '.feature-item:nth-child(5) p': 'archAppDesc',
        '.feature-item:nth-child(6) h3': 'archSecurity',
        '.feature-item:nth-child(6) p': 'archSecurityDesc',
        '.initiatives h2': 'futureTitle',
        '.initiatives p.text-center': 'futureRoadmap',
        '.downloads h2': 'downloadTitle',
        'footer p:nth-child(1)': 'footerCopy',
        'footer p:nth-child(2)': 'footerBuilt'
    };

    for (const [selector, key] of Object.entries(mappings)) {
        const el = document.querySelector(selector);
        if (el) el.innerHTML = t[key];
    }
}

async function fetchTechData() {
    try {
        const response = await fetch('web/assets/data/tech_registry.json');
        const data = await response.json();
        renderTable(data);
        updateStats(data);
    } catch (error) {
        console.error('Error loading tech data:', error);
        document.getElementById('tech-table-body').innerHTML = '<tr><td colspan="6" class="text-center text-red">Error loading data. Please try again.</td></tr>';
    }
}

function renderTable(data) {
    const tbody = document.getElementById('tech-table-body');
    if (!tbody) return;

    tbody.innerHTML = '';

    data.forEach(tech => {
        const row = document.createElement('tr');

        // ID handling (make it code-like)
        const idCell = `<code>${tech.id}</code>`;

        // Check for platforms
        const hasMobile = tech.platforms.some(p => p.includes('mobile'));
        const hasDesktop = tech.platforms.some(p => p.includes('desktop'));
        const hasWeb = tech.platforms.some(p => p.includes('web'));
        const hasServer = tech.platforms.some(p => p.includes('server'));
        const hasJava = tech.platforms.some(p => p.includes('java'));

        const checkInfo = '<span class="status-supported">✓</span>';
        const crossInfo = '<span style="opacity:0.1">-</span>';

        row.innerHTML = `
            <td>${idCell}</td>
            <td><strong>${tech.name}</strong></td>
            <td><small>${tech.category}</small></td>
            <td class="text-center">${hasMobile ? checkInfo : crossInfo}</td>
            <td class="text-center">${hasDesktop ? checkInfo : crossInfo}</td>
            <td class="text-center">${hasWeb ? checkInfo : crossInfo}</td>
            <td class="text-center">${hasServer ? checkInfo : crossInfo}</td>
            <td class="text-center">${hasJava ? checkInfo : crossInfo}</td>
        `;
        tbody.appendChild(row);
    });
}

function updateStats(data) {
    const totalCount = data.length;
    const supportedCount = data.filter(t => t.status === 'supported').length;

    const countEl = document.getElementById('stat-total-techs');
    if (countEl) countEl.innerText = totalCount;

    const supportedEl = document.getElementById('stat-supported');
    if (supportedEl) supportedEl.innerText = `${Math.round((supportedCount / totalCount) * 100)}%`;
}

function setupSmoothScroll() {
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            document.querySelector(this.getAttribute('href')).scrollIntoView({
                behavior: 'smooth'
            });
        });
    });
}
