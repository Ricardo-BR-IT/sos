# Vibe Video 项目 - AI 助手指南

## 从参考图片开始创建项目

### 处理用户粘贴的图片

**重要说明**：Cursor AI 目前无法直接将粘贴的图片保存到文件系统。请使用以下替代方案：

#### 方案1：使用 VS Code 命令（推荐）

当用户在对话框中**粘贴了图片**时，执行以下步骤：

1. **提示用户保存图片**
   - 告诉用户："我看到您粘贴了图片。由于技术限制，我无法直接保存图片。请使用以下方法之一："
   - **方法A**：使用 VS Code 命令 `Vibe Video: 添加参考图`（Ctrl+Shift+P → 输入"添加参考图"）
   - **方法B**：手动将图片保存到 `ref-img/` 目录（右键图片 → 另存为）

2. **基于图片生成剧本**（图片已保存后）
   - 分析图片内容（人物特征、场景环境、画面元素、氛围等）
   - 结合用户提供的文字故事（如果有）
   - 生成完整剧本，保存到 `剧本.md`
   - 在剧本中引用参考图片：`![参考图](ref-img/文件名.jpg)`
   - **注意**：如果用户还未保存图片，提示用户先保存图片，并询问保存后的文件名

#### 方案2：用户先保存图片，再粘贴

如果用户已经将图片保存到 `ref-img/` 目录，则：
1. 直接分析图片内容
2. 生成剧本，引用已保存的图片文件

3. **生成项目结构时确保一致性**（当用户要求"根据剧本.md 生成项目"时）
   - 在生成主体文件时，**必须**包含参考图字段：
     ```markdown
     # 角色名
     
     - **参考图**: ref-img/文件名.jpg
     
     角色外观描述（基于参考图片中的人物特征）...
     ```
   - 如果场景与参考图片相关，场景文件也应包含参考图字段：
     ```markdown
     # 场景名
     
     - **参考图**: ref-img/文件名.jpg
     
     场景描述（基于参考图片中的环境）...
     ```
   - **重要**：主体文件包含参考图字段后，生成主体图片时会使用 `composeMultipleImages` API，系统会基于参考图生成主体图片，确保人物形象与参考图一致

4. **为什么这样能确保一致性？**
   - 主体文件包含参考图字段后，生成主体图片时会使用 `composeMultipleImages` API
   - 系统会基于参考图生成主体图片，确保人物形象与参考图一致
   - 生成首帧时会自动使用主体图片，确保人物在视频中保持一致

### 示例对话流程

**用户**：[粘贴图片] 请基于这张图片为我生成一个视频剧本

**AI 应执行**：
1. **提示用户保存图片**：
   "我看到您粘贴了图片。由于技术限制，我无法直接保存图片文件。请先使用以下方法保存图片：
   
   **方法1（推荐）**：使用 VS Code 命令
   - 按 `Ctrl+Shift+P`（Mac: `Cmd+Shift+P`）
   - 输入"添加参考图"或"Vibe Video: 添加参考图"
   - 选择图片文件
   
   **方法2**：手动保存
   - 右键点击图片 → 另存为
   - 保存到项目的 `ref-img/` 目录
   
   保存完成后，请告诉我文件名，我会基于图片生成剧本。"

2. **用户保存图片后**：
   - 分析图片内容（人物、场景、氛围等）
   - 生成剧本到 `剧本.md`，包含图片引用：`![参考图](ref-img/用户提供的文件名.jpg)`
   - 提示用户："剧本已生成。现在可以输入'根据剧本.md 生成项目'来生成完整项目结构。"

**用户**：根据剧本.md 生成项目

**AI 应执行**：
1. 提取主体，每个主体文件**必须**包含：`- **参考图**: ref-img/reference-image.jpg`
2. 提取场景（如适用，也包含参考图字段）
3. 生成分镜脚本
4. 生成首帧描述

### 完整工作流程

```
用户粘贴图片
    ↓
AI 提示用户使用命令或手动保存图片
    ↓
用户使用 "Vibe Video: 添加参考图" 命令保存图片
    ↓
AI 分析图片，生成剧本.md（引用保存的图片）
    ↓
用户要求"根据剧本.md 生成项目"
    ↓
AI 生成主体文件（包含参考图字段）
    ↓
系统生成主体图片（基于参考图，确保一致）
    ↓
系统生成首帧（使用主体图片）
    ↓
系统生成视频（使用首帧，人物形象一致）
```

### 使用 VS Code 添加参考图的方法

用户可以通过以下方式添加参考图：

1. **侧边栏内联按钮（推荐）**：
   - 在 Vibe Video 侧边栏中，找到 `📸 参考图` 分组
   - 点击分组右侧的 `+` 按钮（"添加参考图"）
   - 支持多选图片文件

2. **命令面板**：
   - 按 `Ctrl+Shift+P`（Mac: `Cmd+Shift+P`）
   - 输入"添加参考图"或"Vibe Video: 添加参考图"
   - 选择图片文件（支持多选）

3. **拖放功能**：
   - 从文件管理器直接拖拽图片文件到侧边栏的 `📸 参考图` 分组
   - 自动保存到 `ref-img/` 目录

4. **手动保存**：
   - 右键点击图片 → 另存为
   - 保存到项目的 `ref-img/` 目录

---

## 核心任务
当用户要求"生成项目"时，执行以下步骤：
1. **写剧本**：根据用户的要求，创作完整的剧本内容，保存到 `剧本.md`
2. **提取主体**：从剧本中提取出主要角色/主体，为每个主体写好主体描述，保存到 `subjects/` 目录。
3. **提取场景**：从剧本中提取出各个场景，为每个场景写好场景描述。
4. **拆分分镜**：将场景拆分成 5秒/10秒 的分镜单元（**分镜时长只能是5秒或10秒**）
5. **生成分镜脚本**：为每个分镜写好详细的脚本（包含景别、技巧、角度、画面内容、音效、音乐等），保存到 `storyboards/` 目录。**必须默认添加以下字段**：
   - **参考图**：默认将对应首帧图片的默认地址作为参考图填入（如：`first-frames/01-opening-first-frame.png`）
   - **首帧**：默认添加当前分镜的首帧图片路径（如：`first-frames/01-opening-first-frame.png`）
   - **尾帧**：默认添加当前分镜的尾帧图片路径（如：`first-frames/02-next-scene-first-frame.png`）。**重要**：尾帧即为下一个分镜的首帧，最后一个分镜可以不填尾帧
   即使图片尚未生成，也要使用默认URL格式填入
6. **生成首帧描述**：根据每个分镜的内容，为每个分镜写好第一帧画面描述（静态画面，避免视频化表述），保存到 `first-frames/` 目录。**默认将分镜中涉及的所有主体和场景作为参考图写入首帧描述**，即使图片尚未生成，也要使用默认URL格式填入（如：`subjects/角色名.png`, `scenes/场景名.png`）。**生成首帧图片时，禁止在图片中加入字幕或花字，禁止描述人物对话或动作（这是一张静态图片）**。**重要**：当提供了主体和场景参考图时，不要重复描述主体形象和场景细节，应重点描述位置关系（如"将图1中的闹钟放置到图2的餐桌的花瓶旁边位置"）或人物表情和姿态（静态信息）

---

## 分镜脚本格式
```markdown
# 场景标题

- **时长**: 5秒 或 10秒（**只能是5秒或10秒**）
- **主体**: 角色1, 角色2（可选）
- **参考图**: first-frames/xxx-first-frame.png（必需，默认填入对应首帧图片的默认URL）
- **首帧**: first-frames/xxx-first-frame.png（必需，默认添加当前分镜的首帧图片路径）
- **尾帧**: first-frames/xxx-next-scene-first-frame.png（必需，默认添加当前分镜的尾帧图片路径。**重要规则**：尾帧即为下一个分镜的首帧，格式为 `first-frames/下一个分镜ID-first-frame.png`。最后一个分镜可以不填尾帧）

- **提示词**：**必须是一段融合的完整描述**，将视频内容、声音（可选）、美学控制（可选）和风格化（可选）自然地融合在一起，**禁止分条列出**。
    
    **重要约束**：
    - ❌ **禁止**分条输出，如"**视频提示词**：... **声音提示词**：... **美学控制**：... **风格化**：..."
    - ✅ **必须**融合成一段连贯的自然语言描述
    
    **提示词应包含的内容**（这些内容需要自然地融合在描述中，而不是分条列出）：
    - **视频内容**：运动描述（如人物动作、动态过程）+ 运镜描述（如"镜头推进"、"固定镜头"等）
    - **声音**（可选）：人声（角色说话内容、情绪、语调、语速、音色、口音）、音效（音源材质+行为+环境音）、背景音乐（风格+情绪）
    - **美学控制**（可选）：光源类型（日光、人工光等）、光线类型（柔光、侧光等）、时间段（白天、夜晚等）、景别（特写、中景等）、构图（中心构图等）、镜头（焦段、角度、类型等）、色调（暖色调、冷色调等）
    - **风格化**（可选）：画面风格语言（如"3D卡通"、"赛博朋克"、"毛毡风格"等）
    
    **重要约束**（当分镜有参考图/首帧/尾帧时）：
    - ❌ **禁止**重复描述主体形象和场景细节（参考图/首帧/尾帧已包含这些信息）
    - ✅ **重点描述**人物动作和声音（动作过程、对话内容、情绪、语调等）
    - ✅ **声音一致性**：如果人物有对话，对同一主角的声音描述（音色、语调、语速、口音等）必须保持一致
    - ❌ **禁止生成字幕**：生成分镜视频时，**绝对不允许**在视频中生成任何字幕、文字或文本叠加层
    
    **正确示例**（融合成一段话）：
    "双人对话，暖色调，日光，柔光，侧光，中景，中心构图，全景。红色背景的舞台铺着光滑的木质地板，两束聚光灯从上方斜射而下，照亮一对恋人。男人比女人略高，身穿剪裁合体的深灰色西装，面容清晰，眼神专注；女人身着酒红色长裙，发丝乌黑柔顺，随微风轻轻飘动。他双手轻捧她的脸颊，拇指缓缓摩挲她颧骨，她微微仰头，双眸含光，与他深情对视。她的长发被他的指尖轻轻拂过，发丝在光线中泛出细腻光泽。两人呼吸轻缓，身体随着无声的旋律微微贴近又分离，仿佛在静默中共舞。背景隐约传来柔和的钢琴前奏，音符如水流动。她轻启唇瓣，低声呢喃："这一刻，像梦一样。" 他凝视着她，回应道："但它是真的。""
    
    **错误示例**（分条输出，禁止）：
    ❌ 
    - **视频提示词**：...
    - **声音提示词**：...
    - **美学控制**：...
    - **风格化**：...
```

---

## 首帧描述格式

### 文件位置
- 目录：`first-frames/`（不存在则创建）
- 命名：`01-opening-first-frame.md` 或 `scene3-first-frame.md`

### 必需字段
```markdown
# 场景标题
- **参考图片**: 路径1, 路径2（必需，默认包含所有主体和场景的图片URL）
- **首帧提示**: 静态画面描述（避免视频化表述），包含画面内容、美学控制（光源、光线环境、景别、视角、镜头、构图、氛围等）和风格化（画面风格语言，例如"赛博朋克"、"勾线插画"、"废土风格"等）。**禁止**在图片中加入字幕或花字，**禁止**描述人物对话或动作（这是一张静态图片）
```

### 参考图片填写规则
- **默认行为**：必须将分镜中涉及的所有主体和场景作为参考图写入
- **URL格式**：
  - 主体图片：`subjects/角色名.png`（如：`subjects/主角.png`, `subjects/配角.png`）
  - 场景图片：`scenes/场景名.png`（如：`scenes/城市街道.png`, `scenes/室内房间.png`）
- **多张图片**：用逗号分隔，如：`subjects/角色1.png, subjects/角色2.png, scenes/场景1.png`
- **即使图片未生成**：也要按照上述格式填入默认URL，后续生成图片时会自动匹配

### 重要约束
- ✅ 只描述单帧静态画面
- ❌ 禁止"镜头移动""动作连贯"等视频化表述
- ❌ **禁止人物对话和动作**：首帧提示词中**禁止**描述人物对话内容或动作过程，这是一张静态图片，只描述静态的画面状态（如人物姿态、表情、位置等）
- ✅ 参考图片路径：相对路径或绝对路径，支持多张（逗号/空格分隔）
- ✅ **必须**填写参考图片字段，默认包含所有相关主体和场景的图片URL
- ❌ **禁止字幕和花字**：生成首帧图片时，**绝对不允许**在图片中加入任何字幕、花字、文字或文本叠加层
- ✅ **当提供了主体和场景参考图时**：
  - ❌ **禁止**重复描述主体形象和场景细节（参考图已包含这些信息）
  - ✅ **重点描述**位置关系：简单说明主体在场景中的位置（如"将图1中的闹钟放置到图2的餐桌的花瓶旁边位置"）
  - ✅ **有人物时**：重点描述人物表情、姿态等静态信息（如"微笑的表情"、"站立的姿态"），而非对话内容或动作过程

---

## 主体功能

### 使用场景
视频中有固定角色时使用，确保角色外观一致。

### 定义主体
在 `subjects/` 目录创建 `角色名.md`：
```markdown
# 角色名

- **参考图**: ref-img/xxx.jpg（可选，但强烈推荐使用，确保形象一致）

角色外观描述...
3D卡通风格，圆润体型，大眼睛...

**约束**：只生成主体本身，背景纯白色（#FFFFFF），无其他物品。
```

### 参考图字段说明
- **格式**：`- **参考图**: ref-img/文件名.jpg` 或 `- **参考图**: ref-img/文件1.jpg, ref-img/文件2.jpg`（多张用逗号分隔）
- **作用**：当主体文件包含参考图字段时，生成主体图片会使用 `composeMultipleImages` API，基于参考图生成，确保人物形象与参考图一致
- **推荐使用**：从参考图片创建项目时，**必须**在主体文件中包含参考图字段

---

## 场景功能

### 使用场景
用于定义视频中的固定环境、背景或空间布局，保证每个分镜中场景的一致性。

### 定义场景
在 `scenes/` 目录创建 `场景名.md`：
```markdown
# 场景名

- **参考图**: ref-img/xxx.jpg（可选，若使用请确保图片中以环境为主）

场景环境描述...
如：现代感的开放式客厅，落地窗外可以看到城市夜景，室内以暖色灯光为主。

**约束**：
- 只描述背景、环境、光线和空间布局
- ❌ 不得描述具体人物、产品或主体细节（这些内容应在 subjects/ 中定义）
- 若参考图中包含人物或主体，生成场景图片时必须忽略这些元素，只保留环境
```

### 参考图字段说明
- **格式**：`- **参考图**: ref-img/文件名.jpg` 或 `- **参考图**: ref-img/bg1.jpg, ref-img/bg2.jpg`
- **作用**：当场景文件包含参考图字段时，生成场景图片会使用 `composeMultipleImages` API，并按照约束去除人物，仅保留环境
- **提示**：如参考图包含人物，请在场景描述中明确写出“只保留背景，不要人物”，避免 AI 将人物带入场景

---

## 首帧和尾帧字段说明

### 首帧字段（必需）
- **必须添加**：每个分镜脚本**必须**包含 `- **首帧**: first-frames/xxx-first-frame.png` 字段
- **URL格式**：`first-frames/分镜ID-first-frame.png`（如：`first-frames/01-opening-first-frame.png`）
- **命名规则**：首帧文件名格式为 `{分镜ID}-first-frame.png`，其中分镜ID与分镜脚本文件名一致（不含扩展名）

### 尾帧字段（必需，最后一个分镜除外）
- **必须添加**：每个分镜脚本**必须**包含 `- **尾帧**: first-frames/xxx-next-scene-first-frame.png` 字段（最后一个分镜可以不填）
- **重要规则**：**尾帧即为下一个分镜的首帧**
- **URL格式**：`first-frames/下一个分镜ID-first-frame.png`
- **示例**：
  - 分镜 `01-opening.md` 的尾帧：`first-frames/02-next-scene-first-frame.png`（即下一个分镜 `02-next-scene.md` 的首帧）
  - 分镜 `02-next-scene.md` 的尾帧：`first-frames/03-final-scene-first-frame.png`（即下一个分镜 `03-final-scene.md` 的首帧）
  - 最后一个分镜可以不填尾帧字段
- **即使图片未生成**：也要按照上述格式填入默认URL，后续生成首帧图片时会自动匹配

## 参考图功能

### 默认参考图（必需）
- **首帧图片**：每个分镜脚本**必须**包含对应首帧图片的默认URL作为参考图
- **URL格式**：`first-frames/场景名-first-frame.png`（如：`first-frames/01-opening-first-frame.png`）
- **即使图片未生成**：也要按照上述格式填入默认URL，后续生成首帧图片时会自动匹配

### 用户自定义参考图（可选）
用户提供参考图片（产品图、场景照片、风格参考等）时，可以额外添加：

#### 放置位置
将图片（.png, .jpg, .jpeg）放入 `ref-img/` 目录。

#### 引用方式
```markdown
- **参考图**: first-frames/01-opening-first-frame.png, ref-img/product.jpg
- **参考图**: first-frames/scene1-first-frame.png, ref-img/img1.jpg, ref-img/img2.jpg（多张，首帧图片在前）
```

### 生成视频时的优先级
**默认采用首帧图生视频来生成视频内容**。生成视频时，图片使用优先级为：
1. **首帧图片**（`first-frames/xxx.png`）- 默认使用首帧图片进行图生视频
2. **参考图**（`ref-img/xxx.jpg`）- 如果用户提供了自定义参考图，可以额外使用
3. **文生视频** - 如果都没有，使用纯文本生成

---

## 分镜时长约束

- ✅ **分镜时长只能是5秒或10秒**
- ❌ 不允许其他时长（如3秒、8秒、15秒等）
- 如果场景内容较长，应拆分为多个5秒或10秒的分镜

---

## 视频生成约束

### 字幕约束（必需）
- ❌ **绝对禁止**：生成分镜视频时，**绝对不允许**在视频中生成任何字幕、文字或文本叠加层
- ✅ **纯视频内容**：视频应只包含画面和声音，不包含任何文字元素
- ✅ **提示词要求**：在生成视频的提示词中，**必须明确禁止**字幕和文字的出现（如"无字幕"、"no subtitles"、"no text"等）

---

## 优先级

1. **描述质量** > 格式规范
2. **内容完整** > 格式完美
3. **视觉清晰** > 技术细节

---

## 文件命名
- 按分镜顺序命名：`01-opening.md`
- 建议使用有意义的名称

---

## 图片生成规范

图片比例已在代码层面规定，无需在提示词中说明。
